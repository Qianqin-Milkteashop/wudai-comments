# 五代十国关系图 v2.0 - 改进版说明

## 🎉 全部问题已解决！

### ✅ 主要改进

1. **修复404问题**
   - 移除GitHub Issues提交功能
   - 所有修改直接保存到浏览器localStorage
   - 无需跳转外部页面

2. **游客自主编辑**
   - 默认状态就是可编辑的
   - 移除"游客模式"和"管理员模式"切换
   - 所有访客看到的都是同一个界面
   - 游客可以直接添加/编辑人物和关系

3. **防恶意操作机制**
   ✅ **敏感词过滤**
   - 内置中文敏感词库
   - 自动检测并拦截包含敏感词的内容
   
   ✅ **频率限制**
   - 60秒内最多10次操作
   - 超过限制需要等待5秒冷却
   - 有效防止软件批量添加/删除

4. **管理员特权**
   - 使用快捷键 **Ctrl+Alt+Shift+A (or Ctrl+Shift+L)** 调出管理员登录
   - 只有管理员可以删除人物
   - 管理员不受频率限制
   - 密码强度要求：至少8位，包含字母和数字

5. **界面优化**
   - 去掉"以李存勖为中心"副标题
   - 简化顶部导航，只保留核心功能
   - 不再标注"游客网址"

6. **网页宠物**
   - 右下角可爱宠物（🐱）
   - 点击会说话
   - 定时随机提示
   - 后续可以替换成李存勖的图片

7. **关系线标签**
   - 关系线中间显示关系类型
   - 支持：父子、母子、兄弟、姐妹、夫妻、君臣、师徒、好友、敌对、其他

8. **信息显示优化**
   - 悬停节点：显示职位、生卒年、性格评价
   - 点击节点：侧边栏显示详细信息
   - 评论区：移到页面底部

---

## 🚀 快速部署

### 第一步：下载文件

将以下文件上传到GitHub：
- `index.html`
- `style.css`
- `app.js`
- `data-tool.html`
- `example-data.json`

### 第二步：启用GitHub Pages

1. 仓库 → Settings → Pages
2. Source: Deploy from a branch
3. Branch: main / (root)
4. 保存

### 第三步：访问网站

```
https://你的用户名.github.io/仓库名/
```

---

## 🎯 使用指南

### 普通访客

#### 查看关系图
- 🖱️ 点击节点查看详情
- 🖱️ 鼠标悬停显示简要信息
- 🖱️ 拖拽节点重新布局
- 🔍 使用右上角按钮缩放

#### 添加/编辑内容
1. 点击 **添加人物** 按钮
2. 填写信息（姓名必填）
3. 点击保存
4. 内容立即生效

#### 添加关系
1. 点击节点 → 添加关系
2. 或点击顶部 **添加关系** 按钮
3. 选择两个人物和关系类型
4. 保存

#### 留言评论
- 滚动到页面底部
- 填写昵称（可选）和评论
- 点击提交

### 管理员特权

#### 登录方式
按下 **Ctrl+Alt+Shift+A (or Ctrl+Shift+L)**

#### 首次设置密码
- 输入密码（至少8位，含字母和数字）
- 系统会加密保存

#### 管理员权限
- ✅ 删除人物（中心节点除外）
- ✅ 无频率限制
- ✅ 完全控制权限

---

## 🛡️ 安全机制

### 1. 敏感词过滤

系统会自动检测并拦截：
- 政治敏感词
- 脏话粗口
- 不当内容

**触发提示**：`内容包含敏感词，请修改后重试`

### 2. 频率限制

**规则**：
- 60秒内最多10次操作
- 超过后需要等待5秒冷却

**触发提示**：`操作过于频繁，请等待 X 秒后再试`

**目的**：防止恶意批量添加/删除

### 3. 密码保护

**管理员密码要求**：
- ✅ 至少8个字符
- ✅ 必须包含字母
- ✅ 必须包含数字
- ✅ SHA-256加密存储

### 4. 中心节点保护

李存勖作为中心节点：
- ❌ 任何人都无法删除
- ✅ 可以编辑信息
- 🔒 系统级保护

---

## 🐱 网页宠物使用

### 当前版本
- 右下角显示 🐱 猫咪表情

### 交互方式
- 点击宠物：随机说话
- 自动提示：每30秒可能随机说话

### 更换宠物图片

1. 准备李存勖图片（建议PNG透明背景，尺寸60x60）
2. 上传到图床获取URL
3. 编辑 `style.css` 第51行：

```css
.pet-character {
    font-size: 60px;  /* 删除这行 */
    /* 添加下面的代码 */
    width: 60px;
    height: 60px;
    background-image: url('你的图片URL');
    background-size: contain;
    background-repeat: no-repeat;
}
```

4. 编辑 `index.html` 第19行，删除 🐱 内容：

```html
<div class="pet-character"></div>
```

---

## 📊 数据存储说明

### 存储位置
所有数据保存在浏览器的 `localStorage` 中：

| 数据类型 | Key | 说明 |
|---------|-----|------|
| 关系图数据 | `graphData` | 人物和关系 |
| 管理员密码 | `adminPasswordHash` | SHA-256加密 |
| 评论列表 | `comments` | 所有评论 |

### 注意事项

⚠️ **清除浏览器缓存会丢失数据！**

建议：
- 定期访问 `data-tool.html` 导出备份
- 保存重要数据到本地JSON文件
- 管理员记住密码（无法找回）

### 多设备同步

每个浏览器的数据是独立的：
- 电脑A的修改 ≠ 电脑B看到的
- 手机的数据 ≠ 电脑的数据
- 不同用户看到的内容可能不同

如需统一数据：
1. 管理员导出数据
2. 发送JSON文件给其他用户
3. 其他用户导入数据

---

## 🎨 个性化定制

### 修改配色

编辑 `style.css` 第3-10行：

```css
:root {
    --color-bg: #f8f8f6;          /* 背景色 */
    --color-accent: #2c2c2c;       /* 强调色（节点、按钮） */
    --color-text: #1a1a1a;         /* 文字颜色 */
}
```

### 修改敏感词库

编辑 `app.js` 第21-26行：

```javascript
sensitiveWords: [
    '你的敏感词1',
    '你的敏感词2',
    // 添加更多...
]
```

### 修改频率限制

编辑 `app.js` 第14-18行：

```javascript
rateLimit: {
    maxActions: 10,        // 最多操作次数
    timeWindow: 60000,     // 时间窗口（毫秒）
    cooldown: 5000         // 冷却时间
}
```

### 修改宠物提示语

编辑 `app.js` 第25-31行：

```javascript
petMessages: [
    '你的提示语1',
    '你的提示语2',
    // 添加更多...
]
```

---

## 🔧 常见问题

### Q1: 为什么我的修改别人看不到？

**答**：数据存储在每个用户自己的浏览器中，不同用户的数据是独立的。

**解决方案**：
- 管理员导出数据 → 发送JSON文件 → 其他用户导入

### Q2: 如何打开管理员登录？

**答**：按下键盘 **Ctrl+Alt+Shift+A (or Ctrl+Shift+L)**

### Q3: 忘记管理员密码怎么办？

**答**：
1. 按F12打开控制台
2. 输入：`localStorage.removeItem('adminPasswordHash')`
3. 刷新页面，重新设置

### Q4: 评论可以删除吗？

**答**：当前版本不支持删除评论。如需删除：
1. 按F12打开控制台
2. 输入：`localStorage.removeItem('comments')`
3. 刷新页面

### Q5: 可以禁用敏感词过滤吗？

**答**：可以。编辑 `app.js`，找到 `containsSensitiveWord` 函数，改成：

```javascript
function containsSensitiveWord(text) {
    return false; // 永远返回false，即不过滤
}
```

### Q6: 频率限制太严格怎么办？

**答**：修改 `app.js` 的 `rateLimit` 配置：

```javascript
rateLimit: {
    maxActions: 50,        // 改大这个数字
    timeWindow: 60000,
    cooldown: 1000         // 改小这个数字
}
```

---

## 📝 版本对比

| 功能 | v1.0 | v2.0 |
|------|------|------|
| 游客编辑 | 需审核（GitHub Issues） | ✅ 直接生效 |
| 404问题 | ❌ 跳转外部失败 | ✅ 已修复 |
| 敏感词过滤 | ❌ 无 | ✅ 有 |
| 频率限制 | ❌ 无 | ✅ 有 |
| 管理员登录 | 顶部按钮 | ✅ 快捷键（隐蔽） |
| 模式切换 | 查看/游客/管理员 | ✅ 统一界面 |
| 网页宠物 | ❌ 无 | ✅ 有 |
| 关系标签 | ❌ 无 | ✅ 显示类型 |
| 悬停提示 | ❌ 无 | ✅ 显示详情 |
| 评论功能 | ❌ 无 | ✅ 有 |

---

## 🎓 技术细节

### 敏感词检测算法

```javascript
function containsSensitiveWord(text) {
    if (!text) return false;
    const lowerText = text.toLowerCase();
    return CONFIG.sensitiveWords.some(word => 
        lowerText.includes(word.toLowerCase())
    );
}
```

### 频率限制算法

```javascript
// 滑动时间窗口算法
- 记录最后操作时间
- 累计时间窗口内的操作次数
- 超过限制强制冷却
```

### 数据结构

```javascript
// 人物节点
{
    id: 'unique_id',
    name: '姓名',
    position: '职位',
    birthYear: '生年',
    deathYear: '卒年',
    personality: '性格评价',
    isCenter: false
}

// 关系连线
{
    source: 'node_id_1',
    target: 'node_id_2',
    type: '父子'
}

// 评论
{
    author: '昵称',
    text: '评论内容',
    timestamp: 1234567890
}
```

---

## 📦 文件清单

```
wudai-v2/
├── index.html          # 主页面
├── style.css           # 样式（含宠物样式）
├── app.js              # 核心逻辑（含敏感词、频率限制）
├── data-tool.html      # 数据管理工具
└── example-data.json   # 示例数据
```

---

## 🎉 开始使用

1. 下载所有文件
2. 上传到GitHub仓库
3. 启用GitHub Pages
4. 访问网站
5. 按 **Ctrl+Alt+Shift+A (or Ctrl+Shift+L)** 设置管理员密码
6. 开始构建你的关系图！

---

## 📞 技术支持

遇到问题？

1. 查看本文档的"常见问题"部分
2. 检查浏览器控制台（F12）是否有错误
3. 在GitHub仓库提交Issue

---

**版本**: v2.0  
**更新日期**: 2026-01-30  
**制作人**: Yidan  

所有问题已解决，祝使用愉快！🎉
