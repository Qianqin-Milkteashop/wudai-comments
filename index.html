<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>五代十国人物关系图</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Serif+SC:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <div class="bg-decoration"><div class="grid-overlay"></div></div>

  <header class="header">
    <div class="container">
      <h1 class="title" id="siteTitle">五代十国人物关系图</h1>
    </div>
  </header>

  <!-- Floating actions -->
  <div class="floating-actions">
    <button class="fab fab-primary" id="btnAddPerson">
      <span class="fab-icon">＋</span><span class="fab-text">添加人物</span>
    </button>
    <button class="fab fab-secondary" id="btnAddRelation">
      <span class="fab-icon">⟷</span><span class="fab-text">添加关系</span>
    </button>
  </div>

  <main class="main-content">
    <aside class="sidebar">
      <h2 class="sidebar-title">人物详情</h2>
      <div id="sidebarContent" class="empty-state">点击人物节点查看详情。</div>
      <div class="help-text" style="margin-top:1.25rem;">
        小提示：点击人物圆点查看信息；下方可以留言评论。
      </div>
    </aside>

    <section class="canvas-container">
      <div class="graph-controls">
        <button class="control-btn" id="btnZoomIn" title="放大">＋</button>
        <button class="control-btn" id="btnZoomOut" title="缩小">－</button>
        <button class="control-btn" id="btnReset" title="复位">⟳</button>
      </div>

      <div id="graph" class="graph-canvas"></div>

      <div id="nodeTooltip" class="node-tooltip">
        <div class="tooltip-name" id="ttName"></div>
        <div class="tooltip-item"><span class="tooltip-label">职位：</span><span id="ttPos"></span></div>
        <div class="tooltip-item"><span class="tooltip-label">生卒年：</span><span id="ttYears"></span></div>
        <div class="tooltip-item"><span class="tooltip-label">性格评价：</span><span id="ttPers"></span></div>
      </div>
    </section>
  </main>

  <!-- Comments -->
  <section class="comments-section">
    <div class="container">
      <h2 class="comments-title">评论</h2>

      <div class="comment-form">
        <div class="form-group">
          <label for="commentAuthor">昵称</label>
          <input id="commentAuthor" class="input" placeholder="匿名" />
        </div>
        <div class="form-group">
          <label for="commentContent">评论</label>
          <textarea id="commentContent" class="textarea" rows="4" placeholder="写点评论吧…"></textarea>
        </div>
        <button class="btn btn-primary btn-block" id="btnPostComment">发布</button>
        <p class="help-text" id="commentHint"></p>
      </div>

      <div class="comments-list" id="commentsList"></div>
    </div>
  </section>

  <!-- Web pet -->
  <div class="web-pet" id="webPet" title="点我">
    <div class="pet-character">🐱</div>
    <div class="pet-bubble" id="petBubble">喵～</div>
  </div>

  <!-- Add/Edit Person Modal -->
  <div id="personModal" class="modal">
    <div class="modal-content modal-large">
      <div class="modal-header">
        <h2 id="personModalTitle">添加人物</h2>
        <button class="modal-close" data-close="personModal">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>昵称</label>
          <input id="personName" class="input" />
        </div>

        <div class="form-group">
          <label>职位</label>
          <input id="personPosition" class="input" />
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>出生年</label>
            <input id="personBirthYear" class="input" />
          </div>
          <div class="form-group">
            <label>去世年</label>
            <input id="personDeathYear" class="input" />
          </div>
        </div>

        <div class="form-group">
          <label>性格评价</label>
          <textarea id="personPersonality" class="textarea" rows="4"></textarea>
        </div>

        <p class="help-text" id="personModalHint"></p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-close="personModal">取消</button>
        <button class="btn btn-danger" id="btnDeletePerson" style="display:none;">删除</button>
        <button class="btn btn-primary" id="btnSavePerson">保存</button>
      </div>
    </div>
  </div>

  <!-- Add Relation Modal -->
  <div id="relationModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>添加关系</h2>
        <button class="modal-close" data-close="relationModal">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>从</label>
          <select id="relSource" class="input"></select>
        </div>
        <div class="form-group">
          <label>到</label>
          <select id="relTarget" class="input"></select>
        </div>

        <div class="form-group">
          <label>关系类型</label>
          <select id="relTypeSelect" class="input">
            <option value="父子">父子</option>
            <option value="母子">母子</option>
            <option value="兄弟">兄弟</option>
            <option value="姐妹">姐妹</option>
            <option value="夫妻">夫妻</option>
            <option value="君臣">君臣</option>
            <option value="师徒">师徒</option>
            <option value="好友">好友</option>
            <option value="敌对">敌对</option>
            <option value="其他">其他</option>
            <option value="__custom__">自定义…</option>
          </select>
        </div>

        <div class="form-group" id="relCustomWrap" style="display:none;">
          <label>自定义类型</label>
          <input id="relCustomType" class="input" placeholder="e.g. 义兄弟 / 养父子" />
        </div>

        <p class="help-text" id="relationModalHint"></p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-close="relationModal">取消</button>
        <button class="btn btn-primary" id="btnSaveRelation">保存</button>
      </div>
    </div>
  </div>

  <!-- Edit Comment Modal -->
  <div id="commentModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>编辑评论</h2>
        <button class="modal-close" data-close="commentModal">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>评论</label>
          <textarea id="editCommentContent" class="textarea" rows="5"></textarea>
        </div>
        <p class="help-text" id="commentModalHint"></p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-close="commentModal">取消</button>
        <button class="btn btn-primary" id="btnSaveCommentEdit">保存</button>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script src="https://cdn.jsdelivr.net/npm/d3@7/dist/d3.min.js"></script>
  <script src="./app.js"></script>
</body>
</html>
